name: Update Submodules

on:
  workflow_dispatch:
  schedule:
    - cron: "0 0 * * *"

jobs:
  update:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Log Into GitHub
        run: |
          git config user.email "${{ secrets.EMAIL }}"
          git config user.name "ZS1ROBOTY3D"

      - name: Check for changes
        id: check_changes
        run: |
          git submodule foreach git diff --exit-code || { echo "Submodule changes found."; echo "found_changes=true" > ${GITHUB_WORKSPACE}/output.txt; }

      - name: Initialize and update submodules
        if: success() && steps.check_changes.outputs.found_changes == 'true'
        run: |
          git submodule update --init --recursive
          git submodule foreach git pull origin main
          git add .
          git commit -m "Update submodules"
          git push origin main
        else
          echo "Skipping submodule update as no changes were found."
        fi
